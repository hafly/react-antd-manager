(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{1166:function(e,t,a){"use strict";a.r(t),a.d(t,"default",function(){return K});a(1108);var n=a(1119),r=a.n(n),i=(a(346),a(354)),l=a.n(i),s=(a(321),a(322)),o=a.n(s),c=(a(95),a(94)),u=a.n(c),d=(a(153),a(65)),h=a.n(d),p=a(9),m=a(10),f=a(12),b=a(11),y=a(13),v=(a(1110),a(1112)),E=a.n(v),g=(a(355),a(350)),O=a.n(g),R=(a(347),a(348)),w=a.n(R),S=a(0),j=a.n(S),k=a(387),C=a(96),A=a(97),I=a(109),V=w.a.Item,x=O.a.Option,_=E.a.TreeNode,K=function(e){function t(){var e,a;Object(p.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(f.a)(this,(e=Object(b.a)(t)).call.apply(e,[this].concat(r)))).state={dataSource:[],menuInfo:[],userList:[],targetKeys:[],isVisibleRoleAdd:!1,isVisibleRoleEdit:!1,isVisibleUserAuth:!1},a.params={},a.selectedRow=void 0,a.columns=[{title:"\u89d2\u8272ID",dataIndex:"id"},{title:"\u89d2\u8272\u540d\u79f0",dataIndex:"role_name"},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"create_time"},{title:"\u4f7f\u7528\u72b6\u6001",dataIndex:"status",render:function(e){return 0===e?"\u505c\u7528":"\u542f\u7528"}},{title:"\u6388\u6743\u65f6\u95f4",dataIndex:"authorize_time"},{title:"\u6388\u6743\u4eba",dataIndex:"authorize_user_name"}],a.onRadioSelect=function(e){a.selectedRow=e},a.handleRoleAdd=function(){a.setState({isVisibleRoleAdd:!0})},a.handleRoleAddSubmit=function(){a.roleAddForm.props.form.validateFields(function(e,t){e||C.a.ajax({url:"/user/add",data:t}).then(function(){a.setState({isVisibleRoleAdd:!1}),a.roleAddForm.props.form.resetFields(),a.requestList()})})},a.handleRoleEdit=function(){var e=a.selectedRow;e?a.setState({menuInfo:e.menus,isVisibleRoleEdit:!0}):h.a.warn({title:"\u4fe1\u606f",content:"\u8bf7\u9009\u62e9\u4e00\u4e2a\u89d2\u8272"})},a.handleRoleEditSubmit=function(){var e=a.permForm.props.form.getFieldsValue();e.role_id=a.selectedRow.id,e.menus=a.state.menuInfo,C.a.ajax({url:"/permission/edit",data:e}).then(function(e){a.setState({isVisibleRoleEdit:!1}),a.requestList()})},a.hanldeUserAuth=function(){var e=a.selectedRow;e?(a.setState({detailInfo:e,isVisibleUserAuth:!0}),a.getRoleUserList(e.id)):h.a.warn({title:"\u4fe1\u606f",content:"\u8bf7\u9009\u62e9\u4e00\u4e2a\u89d2\u8272"})},a.handleUserAuthSubmit=function(){var e={};e.user_ids=a.state.targetKeys,e.role_id=a.selectedRow.id,C.a.ajax({url:"/role/user_role_edit",data:e}).then(function(){a.setState({isVisibleUserAuth:!1}),a.requestList()})},a}return Object(y.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.requestList()}},{key:"requestList",value:function(){var e=this;C.a.ajax({url:"/role/list",data:this.params}).then(function(t){var a=t.data;a.rows.map(function(e,t){return e.key=t}),e.setState({dataSource:a.rows,pagination:A.a.pagination(a,function(t){e.params.page=t,e.requestList()})})})}},{key:"getRoleUserList",value:function(e){var t=this;C.a.ajax({url:"/role/user_list",data:{id:e}}).then(function(e){var a=e.data.rows,n=[],r=[];if(a&&a.length>0){for(var i=0;i<a.length;i++){var l={key:a[i].user_id,name:a[i].user_name,status:a[i].status};1===l.status&&r.push(l.key),n.push(l)}t.setState({userList:n,targetKeys:r})}})}},{key:"render",value:function(){var e=this;return j.a.createElement("div",null,j.a.createElement(o.a,null,j.a.createElement(u.a,{type:"primary",onClick:this.handleRoleAdd},"\u521b\u5efa\u89d2\u8272"),j.a.createElement(u.a,{type:"primary",onClick:this.handleRoleEdit,style:{marginLeft:10,marginRight:10}},"\u8bbe\u7f6e\u6743\u9650"),j.a.createElement(u.a,{type:"primary",onClick:this.hanldeUserAuth},"\u7528\u6237\u6388\u6743")),j.a.createElement("div",{className:"content-wrap",style:{borderTop:0}},j.a.createElement(k.a,{type:"radio",columns:this.columns,dataSource:this.state.dataSource,onSelect:this.onRadioSelect,pagination:this.state.pagination})),j.a.createElement(h.a,{title:"\u521b\u5efa\u89d2\u8272",visible:this.state.isVisibleRoleAdd,onOk:this.handleRoleAddSubmit,onCancel:function(){e.roleAddForm.props.form.resetFields(),e.setState({isVisibleRoleAdd:!1})}},j.a.createElement(U,{wrappedComponentRef:function(t){return e.roleAddForm=t}})),j.a.createElement(h.a,{title:"\u8bbe\u7f6e\u89d2\u8272\u6743\u9650",visible:this.state.isVisibleRoleEdit,width:600,onOk:this.handleRoleEditSubmit,onCancel:function(){e.setState({isVisibleRoleEdit:!1})}},j.a.createElement(F,{wrappedComponentRef:function(t){return e.permForm=t},detailInfo:this.selectedRow,menuInfo:this.state.menuInfo,patchMenuInfo:function(t){e.setState({menuInfo:t})}})),j.a.createElement(h.a,{title:"\u7528\u6237\u6388\u6743",visible:this.state.isVisibleUserAuth,width:740,onOk:this.handleUserAuthSubmit,onCancel:function(){e.setState({isVisibleUserAuth:!1})}},j.a.createElement(L,{detailInfo:this.state.detailInfo,targetKeys:this.state.targetKeys,dataSource:this.state.userList,patchUserInfo:function(t){e.setState({targetKeys:t})}})))}}]),t}(j.a.Component),U=function(e){function t(){return Object(p.a)(this,t),Object(f.a)(this,Object(b.a)(t).apply(this,arguments))}return Object(y.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t={labelCol:{span:5},wrapperCol:{span:19}};return j.a.createElement(w.a,{layout:"horizontal"},j.a.createElement(V,Object.assign({label:"\u89d2\u8272\u540d\u79f0"},t),e("role_name",{initialValue:"",rules:[{required:!0,message:"\u89d2\u8272\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a!"}]})(j.a.createElement(l.a,{type:"text",placeholder:"\u8bf7\u8f93\u5165\u89d2\u8272\u540d\u79f0"}))),j.a.createElement(V,Object.assign({label:"\u72b6\u6001"},t),e("state",{initialValue:1})(j.a.createElement(O.a,null,j.a.createElement(x,{value:1},"\u5f00\u542f"),j.a.createElement(x,{value:0},"\u5173\u95ed")))))}}]),t}(j.a.Component);U=w.a.create({})(U);var F=function(e){function t(){var e,a;Object(p.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(f.a)(this,(e=Object(b.a)(t)).call.apply(e,[this].concat(r)))).handleOnCheck=function(e){a.props.patchMenuInfo(e)},a}return Object(y.a)(t,e),Object(m.a)(t,[{key:"renderTreeNode",value:function(e){var t=this;return e.map(function(e){return e.children?j.a.createElement(_,{title:e.title,key:e.url},t.renderTreeNode(e.children)):j.a.createElement(_,{title:e.title,key:e.url})})}},{key:"render",value:function(){var e=this.props.detailInfo,t=this.props.menuInfo,a=this.props.form.getFieldDecorator,n={labelCol:{span:5},wrapperCol:{span:19}};return j.a.createElement(w.a,{layout:"horizontal"},j.a.createElement(V,Object.assign({label:"\u89d2\u8272\u540d\u79f0"},n),j.a.createElement(l.a,{placeholder:e.role_name,disabled:!0})),j.a.createElement(V,Object.assign({label:"\u72b6\u6001"},n),a("status",{initialValue:e.status})(j.a.createElement(O.a,null,j.a.createElement(x,{value:1},"\u542f\u7528"),j.a.createElement(x,{value:0},"\u505c\u7528")))),j.a.createElement(E.a,{checkable:!0,defaultExpandAll:!0,onCheck:this.handleOnCheck,checkedKeys:t},j.a.createElement(_,{title:"\u5e73\u53f0\u6743\u9650",key:"platform_all"},this.renderTreeNode(I.a))))}}]),t}(j.a.Component);F=w.a.create()(F);var L=function(e){function t(){var e,a;Object(p.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(f.a)(this,(e=Object(b.a)(t)).call.apply(e,[this].concat(r)))).handleChange=function(e){a.props.patchUserInfo(e)},a.filterOption=function(e,t){return t.name.indexOf(e)>-1},a}return Object(y.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.props.detailInfo,t={labelCol:{span:5},wrapperCol:{span:19}};return j.a.createElement(w.a,{layout:"horizontal"},j.a.createElement(V,Object.assign({label:"\u89d2\u8272\u540d\u79f0"},t),j.a.createElement(l.a,{placeholder:e.role_name,disabled:!0})),j.a.createElement(V,Object.assign({label:"\u9009\u62e9\u7528\u6237"},t),j.a.createElement(r.a,{listStyle:{width:250,height:400},dataSource:this.props.dataSource,titles:["\u5f85\u9009\u7528\u6237","\u5df2\u9009\u7528\u6237"],showSearch:!0,locale:{searchPlaceholder:"\u8f93\u5165\u7528\u6237\u540d"},filterOption:this.filterOption,targetKeys:this.props.targetKeys,render:function(e){return e.name},onChange:this.handleChange})))}}]),t}(j.a.Component);L=w.a.create()(L)},387:function(e,t,a){"use strict";a.d(t,"a",function(){return h});a(365);var n=a(366),r=a.n(n),i=a(9),l=a(10),s=a(12),o=a(11),c=a(13),u=a(0),d=a.n(u),h=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(a=Object(s.a)(this,(e=Object(o.a)(t)).call.apply(e,[this].concat(r)))).state={selectedRowKeys:[]},a.onRadioSelect=function(e){a.setState({selectedRowKeys:e})},a.onCheckboxChange=function(e){a.setState({selectedRowKeys:e})},a}return Object(c.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=null;return"radio"===this.props.type?t={type:"radio",selectedRowKeys:this.state.selectedRowKeys,onSelect:function(t){e.onRadioSelect([t.key]),e.props.onSelect(t)}}:"checkbox"===this.props.type&&(t={type:"checkbox",selectedRowKeys:this.state.selectedRowKeys,onChange:function(t,a){e.onCheckboxChange(t),e.props.onChange(a)}}),d.a.createElement(r.a,Object.assign({},this.props,{rowSelection:t}))}}]),t}(d.a.Component)}}]);